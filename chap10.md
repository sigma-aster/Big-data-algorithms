# chap 10

## æ¦‚ç‡è®¡æ•°

è€ƒè™‘è¿™æ ·ä¸€ä¸ªè®¡æ•°å™¨é—®é¢˜ï¼šæ•°æ®æµä¸­åªæœ‰ä¸€ç§æ•°æ®ï¼Œä¹Ÿå°±æ˜¯â€œæŒ‰åŠ¨è®¡æ•°å™¨â€æ“ä½œã€‚ä½ çš„è®¡æ•°å™¨å¯èƒ½éšæ—¶è¢«æŸ¥è¯¢æ€»å…±è¢«æŒ‰äº†å¤šå°‘æ¬¡

è¿™ä¸ªé—®é¢˜ååˆ†å¹³å‡¡ï¼Œä¸€ä¸ªç²¾ç¡®ç®—æ³•å¦‚ä¸‹ï¼š

- ç»´æŠ¤ä¸€ä¸ªæ•° ğ‘›ï¼Œåˆå§‹æ—¶ä¸º 0
- è®¡æ•°å™¨è¢«æŒ‰åŠ¨æ—¶ï¼Œä»¤ ğ‘›â†ğ‘›+1
- æŸ¥è¯¢æ—¶ï¼Œè¿”å› ğ‘›

ä½†æ˜¯å®é™…ä¸Šç®—æ³•å¯ä»¥ä½¿ç”¨æ›´å°‘çš„ç©ºé—´ã€‚ä»¥ä¸‹ç»™å‡ºä¸€ä¸ªç©ºé—´å¤æ‚åº¦ä¸º $o(â¡logâ¡n)$ çš„ç®—æ³•

### **Morris**

- ç»´æŠ¤ä¸€ä¸ªæ•° $X$ï¼Œåˆå§‹æ—¶ä¸º $0$
- è®¡æ•°å™¨è¢«æŒ‰åŠ¨æ—¶ï¼Œä»¥ $2^{-X}$ çš„æ¦‚ç‡ä»¤ $X \leftarrow X+1$
- æŸ¥è¯¢æ—¶ï¼Œè¿”å› $n = 2^X - 1$â€‹

éœ€è¦çš„ç©ºé—´$O(loglogn)$

**è¯æ˜ï¼š**è€ƒè™‘åˆ° $x_0=0$ å³ $E\qty[2^{x_0}]=1$ï¼Œè€Œä¸” $$ \begin{split} \mathbb E\qty[2^{X_{n + 1}}] &= \sum_{j = 0}^{\infty}\mathbb E\qty[2^{X_{n + 1}} \mid X_n = j]\Pr[X_n = j]\\ &= \sum_{j = 0}^{\infty} \qty(2^{j + 1}\cdot \Pr\qty[X_{n + 1} = j + 1 \mid X_n = j] + 2^j\cdot\Pr\qty[X_{n + 1} = j \mid X_n = j])\Pr\qty[X_n = j]\\ &= \sum_{j = 0}^\infty \qty(2^{j + 1}\cdot 2^{-j} + 2^j\cdot (1 - 2^{-j}))\Pr\qty[X_n = j]\\ &= \sum_{j = 0}^\infty\qty(2^j + 1)\Pr\qty[X_n = j]\\ &= \sum_{j = 0}^\infty 2^j\Pr\qty[X_n = j] + \sum_{j = 0}^{\infty}\Pr\qty[X_n = j]\\ &= \mathbb E[2^{X_n}] + 1\\ &= n + 2 \\ \end{split} $$ 

$$E[\hat{n}] = E[2^{X_n-1}-1] = n$$

$$Var[n] = E[(\hat{n} - n)^2] = E[(2^{X_n}-1-n)^2] = E[2^{2X_n}] - (n+1)^2 = \frac{n^2}{2} - \frac{n}{2} < \frac{n^2}{2}$$

æ ¹æ®åˆ‡æ¯”é›ªå¤«ä¸ç­‰å¼$Pr[|\hat{n} - n| \geq \epsilon n] \leq \frac{Var[\hat{n}]}{\epsilon^2 n^2} < \frac{1}{2 \epsilon^2}$

å¯ä»¥çœ‹å‡ºæ¥è¿™æ ·æ²¡ä»€ä¹ˆç”¨ï¼Œå½“$\epsilon \geq 1$æ—¶æ¦‚ç‡æ‰å°äº$\frac{1}{2}$ï¼Œä½†è¿™æ—¶è¯¯å·®å¾ˆå¤§äº†



### **Morris+**

- ç‹¬ç«‹è¿è¡Œ$s$æ¬¡Morrisç®—æ³•ï¼Œè®¾è¿™$s$ä¸ªMorrisç®—æ³•çš„è¾“å‡ºåˆ†åˆ«æ˜¯$\hat{n}_1,\hat{n}_2,\cdots,\hat{n}_s$
- è¾“å‡ºè¿™äº›è¾“å‡ºçš„ç®—æœ¯å¹³å‡$\hat{n} = \frac{1}{s} \sum_j^s\hat{n}_j$

é‡æ–°è€ƒè™‘åˆ‡æ¯”é›ªå¤«ä¸ç­‰å¼$Pr[|\hat{n} - n| \geq \epsilon n] \leq \frac{Var[\hat{n}]}{\epsilon^2 n^2} < \frac{1}{2s \epsilon^2}$

å¯¹äºä»»æ„çš„$\delta$ï¼Œåªéœ€è¦å–$s \geq \frac{1}{2\delta\epsilon^2}$ï¼Œå°±èƒ½è®©$Pr[|\hat{n} - n| \geq \epsilon n] \leq \delta$



### **Morris++**

- å¯¹äºæ‰€æœ‰çš„$i \leq t$ï¼Œå¦‚æœç¬¬$i$ä¸ªMorris+ç®—æ³•ç»™å‡ºäº†æ­£ç¡®çš„ç»“æœ($\hat{n} - n| \leq \epsilon n$)ï¼Œä»¤$Y_i = 1$ï¼Œå¦åˆ™è®°ä¸º$0$ã€‚è¦ä½¿å¾—$Pr[Y_i = 1] > \frac{2}{3}$ï¼Œä¹Ÿå°±æ˜¯å–$\delta = \frac{1}{3},s = \frac{3}{2\epsilon^2}$
- è¾“å‡º$\hat{n}_1,\hat{n}_2,\cdots,\hat{n}_s$çš„ä¸­ä½æ•°$\hat{n}$

è®°$Y = \sum_iY_i$ä¸ºMorrisç®—æ³•ä¸­æ­£ç¡®çš„æ•°é‡ï¼Œé‚£ä¹ˆ$E[Y] \geq \frac{2}{3}t$

å› ä¸ºè¾“å‡ºçš„æ˜¯ä¸­ä½æ•°$\hat{n}$ï¼Œåªè¦$Y \geq \frac{1}{2}t$ï¼Œå°±èƒ½ç»™å‡ºç†æƒ³çš„ç»“æœ

$Pr[\hat{n} = bad] \leq Pr[Y \leq \frac{t}{2}] < Pr[Y-E[Y]<-\frac{t}{6}] \leq e^{-2(\frac{1}{6})^2t} \leq \delta$

å½“$t \geq 18ln(\frac{1}{\delta})$æ—¶ï¼Œå°±èƒ½å¾—åˆ°éœ€è¦çš„ç»“æœ

æ‰€éœ€è¦çš„ç©ºé—´

- ç®—æ³•éœ€è¦çš„s,t   ($O(\frac{1}{\epsilon^2}ln(\frac{1}{\delta}))$)

- æˆ‘ä»¬æ¥ä¸‹æ¥è¯æ˜ï¼šå¦‚æœè°ƒç”¨äº† $s^*$ æ¬¡ Morris ç®—æ³•ï¼Œé‚£ä¹ˆä»¥è‡³å°‘ $\delta^*$ çš„æ¦‚ç‡ï¼Œåœ¨è¿™ ğ‘› æ¬¡è®¡æ•°è¿‡ç¨‹ä¸­æ¯ä¸€ä¸ªæ•°éƒ½ä¸è¶…è¿‡ $\log\qty(\frac{s^*n}{\delta^*})$

  å‡è®¾æŸä¸ª Morris ç®—æ³•åœ¨è¿‡ç¨‹ä¸­è¾¾åˆ°äº† $X = \log(\frac{s^*n}{\delta^*})$ï¼Œé‚£ä¹ˆå®ƒå†å¢åŠ ä¸€æ¬¡çš„æ¦‚ç‡æ˜¯ $\frac 1{2^X}\leq\frac{\delta^*}{s^*n}$ã€‚å› ä¸º $X$ æ€»å…±åªæœ‰ $n$ ä¸ªæœºä¼šå¢åŠ ï¼Œæ‰€ä»¥ $X$ åœ¨ç®—æ³•ç»“æŸçš„æ—¶å€™æœ‰è‡³å¤š $\frac n{2^X}\leq\frac{\delta^*}{s^*}$ çš„æ¦‚ç‡å¢åŠ ã€‚æ€»å…±æœ‰ $s^*$ ä¸ª Morris ç®—æ³•ï¼Œè‡³å¤šæœ‰ $s^*$ ä¸ªæ•°è¾¾åˆ°äº† $\log\qty(\frac{s^*n}{\delta^*})$ éšæ—¶å‡†å¤‡çªç ´ã€‚æ‰€ä»¥åœ¨ç®—æ³•ç»“æŸçš„æ—¶å€™æœ‰è‡³å¤š $\delta^*$ çš„æ¦‚ç‡æŸä¸ª Morris ç®—æ³•çš„ $X$ è¶…è¿‡ $\log\qty(\frac{s^*n}{\delta^*})$ äº†ã€‚è¿™å°±è¡¨æ˜æœ‰è‡³å°‘ $1 - \delta^*$ çš„æ¦‚ç‡æ‰€æœ‰åˆ°è¾¾è¿‡ä¸´ç•Œå€¼ $\log\qty(\frac{s^*n}{\delta^*})$ çš„ ğ‘‹ éƒ½ä¸ä¼šå†å¢é•¿äº†ï¼Œä¹Ÿå°±è¡¨æ˜æœ‰è‡³å°‘ 1âˆ’ğ›¿âˆ— çš„æ¦‚ç‡æ‰€æœ‰ Morris ç®—æ³•ä¸­çš„ ğ‘‹ éƒ½ä¸è¶…è¿‡ $\log(\frac{s^*n}{\delta^*})$

  è¿™å°±è¡¨æ˜ Morris++ ç®—æ³•ä»¥è‡³å°‘ $1 - \delta^*$ çš„æ¦‚ç‡ç©ºé—´å¤æ‚åº¦ä¸º $$ \order{st\log\log(\frac{stn}{\delta^*})} = \order{\qty(\frac 1\epsilon)^2\ln\frac 1\delta\log\log\frac {n\log\frac1\delta}{\epsilon^2\delta^*}} $$

## è“„æ°´æ± æŠ½æ ·

æœ‰ä¸€ä¸ªæ•°æ®æµï¼Œæ•°æ®åœ¨ä¸åœåœ°æµè¿‡â€”â€”ä½ åªèƒ½çœ‹åˆ°æ¯ä¸ªæ•°æ®ä¸€æ¬¡å¹¶ä¸”ä¸èƒ½å°†å®ƒä»¬å…¨éƒ¨å­˜å‚¨ä¸‹æ¥ã€‚ä½ åœ¨ä»»æ„æ—¶åˆ»éƒ½å¯èƒ½è¢«è¦æ±‚ï¼šâ€œå°†åˆšåˆšä½ çœ‹åˆ°çš„æ‰€æœ‰æ•°ä¸­å‡åŒ€éšæœºæŠ½å–ä¸€ä¸ªç»™æˆ‘ã€‚â€

å‡è®¾çœ‹åˆ°çš„æ•°ä¾æ¬¡ä¸º $\{a_i\}_{i = 1, 2, \cdots,\infty}$ã€‚çš„æ€æƒ³ï¼Œå¯ä»¥å®ç°å¦‚ä¸‹åœ°ç®—æ³•ï¼š

- ç»´æŠ¤å˜é‡ $s$ï¼Œåˆå§‹æ—¶å€¼æœªå®šä¹‰
- å½“çœ‹åˆ°æ•°æ® $a_m$ çš„æ—¶å€™ï¼Œæ·éª°å­ï¼Œä»¥ $\frac{1}{m}$ çš„æ¦‚ç‡ä»¤ $s \leftarrow a_m$ï¼Œä»¥ $1 - \frac{1}{m}$ çš„æ¦‚ç‡ä¿æŒ $s$ ä¸å˜
- æŸ¥è¯¢æ—¶ï¼Œç›´æ¥è¾“å‡º $s$

è¿™ä¸ªç®—æ³•çš„æ­£ç¡®æ€§æ¯”è¾ƒæ˜¾ç„¶ã€‚

å½“æ•°æ®æµä¸­æµè¿‡ $m$ ä¸ªæ•°çš„æ—¶å€™ï¼Œå¦‚æœ $s = a_i$ï¼Œé‚£ä¹ˆç¬¬ $i$ æ¬¡æ·éª°å­æ·å¾—äº† $\frac{1}{i}$ å°† $a_i$ ä¿ç•™ä¸‹æ¥ï¼Œè€Œåœ¨ç¬¬ $i+1,i+2,\cdots,m$ çš„æ—¶å€™æ·å¾—äº† $1âˆ’\frac{1}{i+1},1-\frac{1}{i+2},â‹¯,1âˆ’\frac{1}{m}$ è€Œæ²¡æœ‰å°† $a_i$ æ‰”æ‰ã€‚

è¿™äº›äº‹ä»¶éƒ½æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥ $$ \Pr\qty[s_m = a_i] = \frac 1i\cdot \frac i{i + 1}\cdot \frac{i + 1}{i + 2}\cdots\frac {m - 1}m = \frac 1m $$ å¯¹äºä»»æ„çš„ $i = 2,3,\cdots,m$ å‡æˆç«‹ï¼Œä¹Ÿå°±æ˜¯è¯´ $a_1,a_2,\cdots,a_m$ èƒ½ç­‰æ¦‚ç‡åœ°åœ¨ç¬¬ $m$ æ¬¡å‡ºç°

åˆ†æä¸€ä¸‹ç©ºé—´å¤æ‚åº¦ã€‚æˆ‘ä»¬éœ€è¦å­˜å‚¨è¢«æŠ½æ ·çš„æ•°ä¸å½“å‰ç»è¿‡äº†å¤šå°‘æ•°ã€‚å‡è®¾æ‰€æœ‰æ•°éƒ½ä¸è¶…è¿‡ ğ‘›ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç©ºé—´å¤æ‚åº¦å°±æ˜¯ $\order{logâ¡n+logâ¡m}$

## ä¼°è®¡ä¸åŒå…ƒç´ ä¸ªæ•°

éœ€è¦åœ¨ä»»æ„æ—¶åˆ»ä¼°è®¡å½“å‰æ•°æ®æµä¸­ä¸åŒå…ƒç´ çš„ä¸ªæ•°ï¼Œå¹¶ä¸”ç”¨å°½å¯èƒ½å°‘çš„äº‹ä»¶ã€‚è®¾æ•°æ®æµæ˜¯ $\{a_i\}_{i = 1,2,\cdots}$ è€Œä¸”æ‰€æœ‰æ•°éƒ½æ˜¯æ•´æ•°ï¼Œä½ éœ€è¦åœ¨é€ä¸€è¯»å–è¿™äº›æ•°æ®çš„æ—¶å€™éšæ—¶å‡†å¤‡å¥½å›ç­” ä¸åŒå…ƒç´ ä¸ªæ•°

è®¾è¿™ä¸ªæ•°æ®æµä¸­æ•°çš„ä¸Šç•Œæ˜¯ ğ‘›ï¼Œåœ¨è¯»å–å®Œå‰ ğ‘š ä¸ªæ•°çš„æ—¶å€™è¢«è¦æ±‚ä½œç­”ã€‚å¦‚æœéœ€è¦æ±‚å‡ºç²¾ç¡®è§£ï¼š

1. ç»´æŠ¤ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ•°ç»„ ï¼Œå¦‚æœç¬¬$i$ä¸ªæ•°çœ‹è§äº†å°±ç½®ä¸º$1$(space: $n$ bits)

2. å°†å…¨éƒ¨æ•°æ®æµå­˜åœ¨å†…å­˜ä¸­(space: $mlog(n)$ bits)

   éœ€è¦$min\{n,mlog(n)\}$æ¯”ç‰¹å†…å­˜

æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªç©ºé—´å¤æ‚åº¦æ˜¯ $\order {logâ¡(nm)}$ çš„è¿‘ä¼¼ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å¯¹ä»»æ„çš„å‚æ•° $\epsilon,\delta \in (0,1)$ï¼Œæ±‚å‡ºä¸€ä¸ª $\hat{t}$ æ»¡è¶³ $Pr\qty[|\hat{t}-t| > \epsilon t] < \delta$ï¼Œå…¶ä¸­ $t$ æ˜¯æ•°æ®æµä¸­ä¸åŒå…ƒç´ çš„ä¸ªæ•°

### FMç®—æ³•

- é€‰æ‹©ä¸€ä¸ªéšæœºå‡½æ•°$h:[n] \rightarrow [0,1]$

- ä¿ç•™ä¸€ä¸ªè®¡æ•°å™¨$X:min_{i\in stream}h(i)$
- è¾“å‡º$\hat{t} = \frac{1}{x}-1$

æ–­è¨€1ï¼š$E[X] = \frac{1}{t+1}$

è¯æ˜ï¼š

â€‹	$\begin{split} E[X] &= \int_0^{\infty}Pr[X \geq \lambda]d\lambda \\ &= \int_0^{\infty}Pr[i \in stream,h(i)\geq\lambda] \\ &= \int_0^{\infty}\Pi_r^t Pr[h(i_r) \geq \lambda]d\lambda \\ &= \int_0^1(1-\lambda)^td\lambda \\ &= \frac{1}{t+1} \end{split}$

æ–­è¨€2ï¼š$E[X^2] = \frac{2}{(t+1)(t+2)}$

è¯æ˜ï¼š

â€‹	$\begin{split} E[X^2] &=\int_0^{\infty}Pr[X^2\geq\lambda]\lambda \\ &= \int_0^{\infty}Pr[X\geq\sqrt{\lambda}]d\lambda \\ &=\int_0^{\infty}(1-\sqrt{\lambda})^td\lambda \\ &= 2\int_0^1u^t(1-u)du \\ &=\frac{2}{(t+1)(t+2)}   \end{split}$

å› æ­¤$Var[X] = E[X^2] - (E[X])^2 = \frac{t}{(t+1)^2(t+2)} < \frac{1}{(t+1)^2}$



### FM+ç®—æ³•

- ç‹¬ç«‹è¿è¡Œ$s = \frac{25}{\epsilon^2\delta}$æ¬¡FMç®—æ³•ï¼Œå¹¶ä¸”å¾—åˆ°ç»“æœ$X_1,\cdots,X_s$

- ä»¤$Z = \frac{1}{s}\sum_i^sX_i$ï¼Œè¾“å‡º$\hat{t} = \frac{1}{z}-1$

æ–­è¨€3ï¼š$Pr[|Z - \frac{1}{t+1}| > \frac{\delta}{5(t+1)}] < \delta$

è¯æ˜ï¼š

â€‹	$\begin{split} E[Z] &= \frac{1}{t+1} \\ \end{split}$ 

â€‹	$Var[Z] < \frac{1}{s(t+1)^2}$

â€‹	ç”±äºåˆ‡æ¯”é›ªå¤«ä¸ç­‰å¼

â€‹	$Pr[|Z-\frac{1}{t+1}| > \frac{\epsilon}{5(t+1)}] < \frac{25(t+1)^2}{\epsilon^2}\frac{1}{s(t+1)^2} < \delta$

æ–­è¨€4ï¼š$Pr[|(\frac{1}{z}-t| > \epsilon t] < \delta$ï¼Œif $\epsilon < \frac{1}{2}$

è¯æ˜ï¼š

â€‹	å¦‚æœ$t = 0$ï¼Œç»“æœæ˜¯æ˜¾ç„¶çš„

â€‹	å¦‚æœ$t \geq 1$ï¼Œæ ¹æ®æ–­è¨€3ï¼Œæœ‰å¤§äº$1-\delta$çš„æ¦‚ç‡æ»¡è¶³

â€‹	$\frac{1-\frac{\epsilon}{5}}{t+1} < Z < \frac{1+\frac{\epsilon}5{}}{t+1}$

â€‹	$\rightarrow \frac{t+1}{1+\frac{\epsilon}{5}} < \frac{1}{Z} < \frac{t+1}{1-\frac{\epsilon}{5}}$

â€‹	$\rightarrow \frac{t-\frac{\epsilon}{5}}{1+\frac{\epsilon}{5}} < \frac{1}{Z} - 1 < \frac{t+\frac{\epsilon}{5}}{1-\frac{\epsilon}{5}}$

â€‹	$\rightarrow \frac{1}{Z} - 1 > \frac{t-\frac{\epsilon}{5}}{1+\frac{\epsilon}{5}} = t -\frac{2\epsilon t}{5} + \frac{\epsilon^2}{25} > t - \epsilon t$

â€‹	åŒç†$\frac{1}{Z} < t + \epsilon t$ (éœ€è¦åˆ©ç”¨$\epsilon \leq \frac{1}{2}$)

â€‹	æ‰€ä»¥æœ‰$|\frac{1}{Z} - 1 - t| < \epsilon t$



### FM++ç®—æ³•

- ç‹¬ç«‹è¿è¡Œ$q = 18ln(\frac{1}{\delta})$æ¬¡FM+ç®—æ³•ï¼Œå…¶ä¸­$\delta_{FM+} = \frac{1}{3}$ã€‚å¾—åˆ°ç»“æœ$\hat{t}_1,\cdots,\hat{t}_q$
- è¾“å‡ºå¾—åˆ°$\hat{t}_1,\cdots,\hat{t}_q$çš„ä¸­ä½æ•°$\hat{t}$

æ–­è¨€5ï¼š$Pr[|\hat{t}-t| > \epsilon t] \leq \delta$

â€‹	è¯æ˜å’ŒMorris++æ—¶ä¸€æ ·



# Frequent Items/Heavy hitters

## æ‰¾åˆ°é¢‘ç¹é¡¹

è¾“å…¥ï¼šä¸€ä¸ªæ•´æ•°æ•°æ®æµ$i_1,\cdots,i_m$å’Œä¸€ä¸ªæ•´æ•°$k \geq 1$

é—®é¢˜ï¼šæ‰¾åˆ°æ‰€æœ‰å‡ºç°é¢‘ç‡$f_i > \frac{m}{k+1}$çš„æ•´æ•°$i$

**Misra-Gries ç®—æ³•**

ç”¨æ•°ç»„$A$è®°å½•$k$é¡¹å’Œä»–ä»¬çš„æ¬¡æ•°

1. å¦‚æœä¸‹ä¸€ä¸ª$x$æ˜¯è®¡æ•°å™¨$k$é¡¹ä¸­çš„ï¼Œä»¤å¯¹åº”è®¡æ•°å™¨åŠ ä¸€
2. å¦‚æœæœ‰è®¡æ•°å™¨ä¸ºç©ºï¼Œå°†$x$æ”¾å…¥$A$å¹¶è®¡æ•°ä¸º1
3. å¦åˆ™ä»¤å…¨éƒ¨$k$é¡¹è®¡æ•°å™¨å‡ä¸€ï¼Œç­‰äº0çš„é¡¹ç§»å‡ºè®¡æ•°å™¨

è¾“å‡ºæ‰€æœ‰$A$ä¸­çš„$k$é¡¹

å®šç†ï¼šæ•°æ®æµä¸­ä»»æ„é¢‘ç‡$f_i > \frac{m}{k+1}$çš„é¡¹ä¸€å®šåœ¨$A$ä¸­

å†éå†ä¸€éåˆ¤æ–­æ˜¯å¦å­˜é¢‘ç‡çœŸçš„å¤§äº$\frac{m}{k+1}$

ä¸ºäº†è¯æ˜è¿™ä¸ªå‘½é¢˜ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªè¾…åŠ©å˜é‡ $\hat{f}_i$ï¼šå¦‚æœ $i$ åœ¨ç®—æ³•ç»“æŸçš„æ—¶å€™åœ¨ $A$ ä¸­ï¼Œé‚£ä¹ˆ $\hat{f}_i$ å°±æ˜¯å®ƒå¯¹åº”è®¡æ•°å™¨çš„å€¼ï¼›å¦‚æœ $i$ ä¸åœ¨ï¼Œé‚£ä¹ˆ $\hat{f}_i = 0$ã€‚

å®šç†ï¼š$f_i - \frac{m}{k+1} \leq \hat{f}_i \leq f_i$å¯¹ä»»æ„çš„$i$æˆç«‹

è¯æ˜ï¼š

â€‹	å°†ç®—æ³•çš„æè¿°ä¿®æ”¹ä¸ºç­‰ä»·å½¢å¼

â€‹	1. å¯¹æ¯ä¸ªæ•° $i = 1,2,\cdots,n$ éƒ½ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ $\hat{f}_i$ï¼Œåˆå§‹æ—¶$\hat{f} \leftarrow \hat{0}$ 

â€‹	2. å½“æ•°æ®æµå…¥ç¬¬$i$ä¸ªæ•°æ—¶

â€‹		å¦‚æœ$\hat{f}_i > 0$ï¼Œé‚£ä¹ˆ$\hat{f}_i \leftarrow \hat{f}_i+1$

â€‹		å¦‚æœ$\hat{f}_i = 0$ä¸”å½“å‰è®¡æ•°å™¨$\hat{f}$ä¸­çš„æ•´æ•°ä¸è¶³$k$ä¸ªï¼Œ$\hat{f}_i = 1$

â€‹		å¦åˆ™$\hat{f}$ä¸­çš„æ­£æ•°å…¨éƒ¨è‡ªå‡$1$

æ˜¾ç„¶æ»¡è¶³$\hat{f}_i \leq f_i$

è®¾ $\alpha_i = f_i - \hat{f}_i$ã€‚æ•°æ®æµåˆå§‹åŒ–æ²¡æœ‰æµå…¥ä»»ä½•æ•°çš„æ—¶å€™ï¼Œæœ‰ $\alpha = 0$ã€‚å½“æµå…¥ç¬¬ $j$ ä¸ªæ•°çš„æ—¶å€™

- å¦‚æœ $i_j = i$ï¼Œä¸”å½“å‰æ­¥éª¤ä¸­ $\hat{f}_i$ è‡ªå¢äº† 1ï¼Œé‚£ä¹ˆè¿™å¯¹åº”ä¸Šè¿°çš„ç¬¬ 1 ç§æˆ–è€…ç¬¬ 2 ç§è‡ªå¢æƒ…å†µï¼Œ$\alpha_i$ ä¸ä¼šå˜åŒ–
- å¦‚æœ $i_j=i$ï¼Œä¸”å½“å‰æ­¥éª¤ä¸­ $\hat{f}_i$ æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆè¿™å¯¹åº”ä¸Šè¿°çš„ç¬¬ 3 ç§å…¨éƒ¨è‡ªå‡æƒ…å†µï¼Œ$\alpha_i$ å¢åŠ  1
- å¦‚æœ $i_j \neq i$ï¼Œä¸”å½“å‰æ­¥éª¤ä¸­ $\hat{f}_i$ æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆå¾ˆé«˜å…´åœ° $\alpha_i$ ä¹Ÿä¸ä¼šå˜åŒ–
- å¦‚æœ $i_j \neq i$ï¼Œä¸”å½“å‰æ­¥éª¤ä¸­ $\hat{f}_i$ è‡ªå‡äº† 1ï¼Œé‚£ä¹ˆè¿™ä¸€å®šæ˜¯ä¸Šè¿°çš„ç¬¬ 3 ç§å…¨éƒ¨è‡ªå‡æƒ…å†µå¯¼è‡´çš„ï¼Œ$\alpha_i$ å¢åŠ  

è®¾å…¨éƒ¨è‡ªå‡å‘ç”Ÿäº†$l$æ¬¡ï¼Œæ¯æ¬¡$\alpha_i$å¢åŠ éƒ½æ˜¯å…¨éƒ¨è‡ªå‡å¯¼è‡´çš„ï¼Œæ‰€ä»¥$\alpha_i \leq l$

å…¨éƒ¨è‡ªå‡å‘ç”Ÿäº† $l$ æ¬¡ï¼Œæ•°æ®æµç§æ€»å…±æµå…¥äº† $m$ ä¸ªæ•°ï¼Œæ‰€ä»¥è‡ªå¢å‘ç”Ÿäº† ğ‘šâˆ’ğ‘™ æ¬¡ï¼Œè‡ªå¢æ€»å…±è®© $\sum\hat{f}_i$ å¢åŠ äº† $m-l$ï¼Œè€Œå…¨éƒ¨è‡ªå‡è®© $\sum\hat{f}_i$ å‡å°‘äº† $kl$

å› ä¸º$\sum\hat{f}_i \geq 0$ï¼Œæ‰€ä»¥$\sum\hat{f}_i = m-(k+1)l \geq 0$ï¼Œä¹Ÿå°±æ˜¯$l \leq \frac{m}{(k+1)l}$

æ‰€ä»¥$f_i - \hat{f}_i = \alpha_i \leq l \leq \frac{m}{(k+1)l}$

ç©ºé—´å¤æ‚åº¦$O(k(logn+logm))$æ¯”ç‰¹

## Turnstile Streaming Model

æˆ‘ä»¬åœ¨æµå…¥ $i_j \in \{1,2,\cdots,n\}$ çš„æ—¶å€™ï¼ŒåŒæ—¶æµå…¥ä¸€ä¸ªè¾…åŠ©å˜é‡$\Delta_j \in R$ã€‚æµå…¥ $(i_j, \Delta_j)$ æ„å‘³ç€ä»¤ $x_{i_j} \leftarrow x_{i_j} + \Delta_j$

Turnstile Streaming Model ä¸å¯¹ $\Delta_j$ è¿›è¡Œä»»ä½•é™åˆ¶ï¼Œåªè¦ $\Delta_j \in R$ å°±è¡Œã€‚

## ä¸¤ä¸ªé—®é¢˜

ä»æœ¬èŠ‚å¼€å§‹ï¼Œæˆ‘ä»¬é»˜è®¤ä½¿ç”¨ Strict Turnstile Streaming Modelï¼Œè€Œéä¼ ç»Ÿçš„æ•°æ®æµæ¨¡å‹

$(k,l_1)$ å•ç‚¹æŸ¥è¯¢é—®é¢˜æŒ‡ï¼šä»»æ„æ—¶åˆ»è¯¢é—®ä»»æ„çš„ $i \in \{1,2,\cdots,n\}$ï¼Œéœ€è¦è¾“å‡º $\widetilde{x}_i = x_i \pm \frac{1}{k}||x||_1$

$(k,l_1)$ ä¼—æ•°æŸ¥è¯¢é—®é¢˜æŒ‡ï¼šä»»æ„æ—¶åˆ»è¿›è¡Œè¯¢é—®ï¼Œéœ€è¦è¾“å‡ºé›†åˆ $L$ æ»¡è¶³ï¼š

- $|L|=\order{k}$
- å¦‚æœ $|x_i| > \frac{1}{k}||x||_1$ï¼Œé‚£ä¹ˆ $i \in L$

> Misra Gries ç®—æ³•å°±æ˜¯åœ¨ä¼ ç»Ÿæ•°æ®æµæ¨¡å‹ä¸‹è§£å†³ä»¥ä¸Šé—®é¢˜çš„ä¸€ä¸ªç®—æ³•

**å¼•ç†ï¼š**è®¾ ğ´ æ˜¯ä¸€ä¸ª $(3k,l_1)$ å•ç‚¹æŸ¥è¯¢é—®é¢˜çš„ç®—æ³•ï¼Œå…¶å¤±è´¥æ¦‚ç‡ä¸è¶…è¿‡ $\frac{\delta}{n}$ï¼Œä¸”æ¶ˆè€—ç©ºé—´ä¸º $s$ æ¯”ç‰¹ã€‚é‚£ä¹ˆå¯ä»¥æ„é€ å‡ºä¸€ç§è§£å†³ $(k,l_1)$ ä¼—æ•°æŸ¥è¯¢é—®é¢˜çš„ç®—æ³• $A^{'}$ï¼Œå¤±è´¥æ¦‚ç‡ä¸è¶…è¿‡ $\delta$ï¼Œæ¶ˆè€— $s+\order{klogâ¡n}$ æ¯”ç‰¹

åœ¨ $A$ ç®—æ³•çš„åŸºç¡€ä¸Šæˆ‘ä»¬è¿™æ ·æ„é€  $A^{'}$ï¼šæŸ¥è¯¢æ—¶ï¼Œéå† $i=1,2,\cdots,n$ï¼Œä½¿ç”¨ ğ´ ç®—æ³•ä¾æ¬¡å•ç‚¹æŸ¥è¯¢è¿™ $n$ ä¸ªç‚¹çš„å€¼ï¼ŒåŒæ—¶è®°ä½å‰ $3k$ å¤§çš„æ•°å¹¶è¾“å‡º

æˆ‘ä»¬è¯æ˜æ‰€æœ‰å‡ºç°æ¬¡æ•°ä¸ä½äº $\frac{1}{k}||x||_1$ çš„æ•°éƒ½è¢«è¾“å‡ºäº†ã€‚å› ä¸ºä¸€ä¸ªå•ç‚¹æŸ¥è¯¢å¤±è´¥çš„æ¦‚ç‡ä¸è¶…è¿‡ $\delta n$ï¼Œæ‰€ä»¥æ‰€æœ‰å•ç‚¹æŸ¥è¯¢å¤±è´¥è‡³å°‘ä¸€æ¬¡çš„æ¦‚ç‡è‡³å¤šä¸º $\delta$ï¼Œè¿™äº›å•ç‚¹æŸ¥è¯¢å…¨éƒ¨æˆåŠŸçš„æ¦‚ç‡è‡³å°‘ä¸º $1-\delta$

- å¦‚æœ $x_i > \frac{1}{k}||x||_1$ï¼Œåˆ™$\hat{x}_i > \frac{1}{k}||x||_1 - \frac{1}{3k}||x||_1 = \frac{2}{3k}||x||_1$
- å¦‚æœ $x_i \leq \frac{1}{3k}||x||_1$ï¼Œåˆ™$\hat{x}_i \leq \frac{1}{3k}||x||_1 + \frac{1}{3k}||x||_1 = \frac{2}{3k}||x||_1$

è¿™è¯´æ˜æœ‰ä¸è¶…è¿‡$3k$ä¸ª$x_i \geq \frac{1}{3k}||x||_1$ï¼Œç»™å‡ºçš„é›†åˆä¸€å®šåŒ…å«äº†æ‰€æœ‰$x_i \geq \frac{1}{k}||x||_1$

éœ€è¦çš„ç©ºé—´ä¹Ÿå°±æ˜¯$s+3k\order{logn} = s+\order{klogâ¡n}$

## Count Min Sketch

é’ˆå¯¹ Strict Turnstile Streaming Model æ¥ç»™å‡ºä¸€ä¸ª $(k,l_1)$ å•ç‚¹æŸ¥è¯¢ç®—æ³•ã€‚å›å¿†ä¸€ä¸‹ Strict Turnstile Streaming Modelï¼Œè¯¥æ¨¡å‹è¦æ±‚è¾“å…¥æ»¡è¶³ä»»æ„æ—¶åˆ» $x$ ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯éè´Ÿ

å…ˆç»™å‡ºç®—æ³•ã€‚è®¾ $w,d$ æ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬åé¢å†å¯¹å…¶é€‰æ‹©ï¼š

1. é€‰æ‹© $d$ ä¸ª 2 å…ƒç‹¬ç«‹éšæœºå“ˆå¸Œå‡½æ•° $h_1,h_2,\cdots,h_d$ï¼Œå®ƒä»¬å°† ${1,2,\cdots,n}$ å‡åŒ€åœ°æ•£åˆ—åˆ° ${1,2,\cdots,w}$ ä¸Š
2. ç»´æŠ¤ä¸€ä¸ªäºŒç»´æ•°ç»„ $C$ï¼Œåˆå§‹åŒ– $C_{i,j} = 0$
3. å½“æ•°æ®æµä¸­æµå…¥ $e_t = (i_t,\Delta_t)$ çš„æ—¶å€™ï¼Œéå†æ¯ä¸ªå“ˆå¸Œå‡½æ•° $h_1,h_2,\cdots,h_d$ã€‚å½“éå†åˆ°å‡½æ•° $h_l$ çš„æ—¶å€™ï¼Œæ›´æ–° $C_{l,h_l(i_t)} \leftarrow C_{l,h_l(i_t)} + \Delta_t$
4. è®° $\hat{x} = min_lC_{l,h_l(i)}$ï¼Œä½œä¸ºæŸ¥è¯¢ $x_i$ æ—¶çš„è¾“å‡ºç»“æœ

å¼•ç†1ï¼š

â€‹	è€ƒè™‘ Strict Turnstile Streaming Modelï¼Œä»¤$d = \Omega(log(\frac{1}{\delta}))$å¹¶ä¸”$w > 2k$ã€‚åˆ™å¯¹äºç»™å®šçš„$i$æœ‰$x_i \leq \hat{x}_i$å¹¶ä¸”$Pr[\hat{x}_i \geq x_i + \frac{||x||_1}{k}] \leq \delta$

è¯æ˜ï¼š

â€‹	ç»™å®š$l$å’Œ$i$ï¼Œ$h_l(i)$æ˜¯ä¸€ä¸ªæ¡¶ï¼Œå°†$i$æ˜ å°„åˆ°$Z_l = C[l,h_l(i)]$

â€‹	$\begin{split} E[Z_l] &= x_i + \sum_{i^{'} \neq i}Pr[h_l(i^{'}) = h_l(i)]x_{i^{'}}\\ &=x_i +\sum_{i^{'} \neq i}\frac{x_i}{w}\\ &< x_i +\frac{1}{2k}||X||_1 \\ \end{split}$

â€‹	å› ä¸ºè€ƒè™‘çš„æ˜¯Strict Turnstile Streaming Modelï¼Œ$Z_l - x_i$æ˜¯éè´Ÿçš„ã€‚

â€‹	æ ¹æ®é©¬å°”å¯å¤«ä¸ç­‰å¼$Pr[Z_l - x_i > \frac{||X||_1}{k}] < \frac{1}{2}$

â€‹	ç”±äºå“ˆå¸Œå‡½æ•°ç›¸äº’ç‹¬ç«‹

â€‹	$Pr[min_lZ_l \geq x_i + \epsilon||X||_1] < (\frac{1}{2})^d < \delta$

â€‹	å¦‚æœæˆ‘ä»¬é€‰æ‹©$d = \Omega(log(n)), w=3k$ï¼Œé‚£å°†æœ‰$1-\frac{1}{n}$çš„æ¦‚ç‡æ»¡è¶³$\hat{x}_i \leq x_i +\frac{||X||_1}{k}$

â€‹	ç©ºé—´å¤æ‚åº¦$\order{klognlogm}$æ¯”ç‰¹

## Count Sketch

Count Min Sketch ç®—æ³•ä¸­ç©ºé—´å¤æ‚åº¦å¤§çº¦æ˜¯å…³äº ğ‘˜ çš„çº¿æ€§å…³ç³»ï¼Œè¿˜æ˜¯å¯ä»¥ä½¿ç”¨ç±»ä¼¼ Count Min Sketch çš„ç®—æ³•ä¸åˆ†ææ¥æ±‚è§£ ğ‘™2 èŒƒæ•°ä¸­çš„é—®é¢˜

1. é€‰æ‹© $d$ ä¸ª 2 å…ƒç‹¬ç«‹éšæœºå“ˆå¸Œå‡½æ•° $h_1,h_2,\cdots,h_d$ï¼Œå®ƒä»¬å°† ${1,2,\cdots,n}$ å‡åŒ€åœ°æ•£åˆ—åˆ° ${1,2,\cdots,w}$ ä¸Šï¼Œå†é€‰æ‹© $d$ ä¸ª 2 å…ƒç‹¬ç«‹éšæœºå“ˆå¸Œå‡½æ•° $g_1,g_2,\cdots,g_d$ï¼Œå®ƒä»¬å°† ${1,2,\cdots,n}$ å‡åŒ€åœ°æ•£åˆ—åˆ° $\{-1,1\}$ ä¸Š
2. ç»´æŠ¤ä¸€ä¸ªäºŒç»´æ•°ç»„ $C$ï¼Œåˆå§‹åŒ– $C_{i,j} = 0$
3. å½“æ•°æ®æµä¸­æµå…¥ $e_t = (i_t,\Delta_t)$ çš„æ—¶å€™ï¼Œéå†æ¯ä¸ªå“ˆå¸Œå‡½æ•° $h_1,h_2,\cdots,h_d$ã€‚å½“éå†åˆ°å‡½æ•° $h_l$ çš„æ—¶å€™ï¼Œæ›´æ–° $C_{l,h_l(i_t)} \leftarrow C_{l,h_l(i_t)} + g_l(i_t)\Delta_t$
4. è®° $\hat{x} = median\{g_l(i)C_{l,h_l(i)} \}$ï¼Œä½œä¸ºæŸ¥è¯¢ $x_i$ æ—¶çš„è¾“å‡ºç»“æœ

ä»¿ç…§ä¸Šä¸€é—®ï¼Œä½†æ˜¯$E[Z_t] = X_i$

$Var[Z_t] = \sum_{i^{'} \neq i}x_{i^{'}}^2E[Y_{i^{'}}^2] < \frac{||X||_2^2}{w}$

ç„¶åå…ˆç”¨åˆ‡æ¯”é›ªå¤«ä¸ç­‰å¼å¾—åˆ°

$Pr[|Z_t-x_i|\geq \frac{||X||_2}{k}] \leq \frac{k^2}{w} < \frac{1}{3}$

å†åˆ©ç”¨Morris++ï¼ŒFM++ä¸­å…³äºä¸­ä½æ•°çš„æ–¹æ³•è§£å†³