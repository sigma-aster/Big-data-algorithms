# chap 10

## æ¦‚ç‡è®¡æ•°

è€ƒè™‘è¿™æ ·ä¸€ä¸ªè®¡æ•°å™¨é—®é¢˜ï¼šæ•°æ®æµä¸­åªæœ‰ä¸€ç§æ•°æ®ï¼Œä¹Ÿå°±æ˜¯â€œæŒ‰åŠ¨è®¡æ•°å™¨â€æ“ä½œã€‚ä½ çš„è®¡æ•°å™¨å¯èƒ½éšæ—¶è¢«æŸ¥è¯¢æ€»å…±è¢«æŒ‰äº†å¤šå°‘æ¬¡

è¿™ä¸ªé—®é¢˜ååˆ†å¹³å‡¡ï¼Œä¸€ä¸ªç²¾ç¡®ç®—æ³•å¦‚ä¸‹ï¼š

- ç»´æŠ¤ä¸€ä¸ªæ•° ğ‘›ï¼Œåˆå§‹æ—¶ä¸º 0
- è®¡æ•°å™¨è¢«æŒ‰åŠ¨æ—¶ï¼Œä»¤ ğ‘›â†ğ‘›+1
- æŸ¥è¯¢æ—¶ï¼Œè¿”å› ğ‘›

ä½†æ˜¯å®é™…ä¸Šç®—æ³•å¯ä»¥ä½¿ç”¨æ›´å°‘çš„ç©ºé—´ã€‚ä»¥ä¸‹ç»™å‡ºä¸€ä¸ªç©ºé—´å¤æ‚åº¦ä¸º $o(â¡logâ¡n)$ çš„ç®—æ³•

### **Morris**

- ç»´æŠ¤ä¸€ä¸ªæ•° $X$ï¼Œåˆå§‹æ—¶ä¸º $0$
- è®¡æ•°å™¨è¢«æŒ‰åŠ¨æ—¶ï¼Œä»¥ $2^{-X}$ çš„æ¦‚ç‡ä»¤ $X \leftarrow X+1$
- æŸ¥è¯¢æ—¶ï¼Œè¿”å› $n = 2^X - 1$â€‹

éœ€è¦çš„ç©ºé—´$O(loglogn)$

**è¯æ˜ï¼š**è€ƒè™‘åˆ° $x_0=0$ å³ $E\qty[2^{x_0}]=1$ï¼Œè€Œä¸” $$ \begin{split} \mathbb E\qty[2^{X_{n + 1}}] &= \sum_{j = 0}^{\infty}\mathbb E\qty[2^{X_{n + 1}} \mid X_n = j]\Pr[X_n = j]\\ &= \sum_{j = 0}^{\infty} \qty(2^{j + 1}\cdot \Pr\qty[X_{n + 1} = j + 1 \mid X_n = j] + 2^j\cdot\Pr\qty[X_{n + 1} = j \mid X_n = j])\Pr\qty[X_n = j]\\ &= \sum_{j = 0}^\infty \qty(2^{j + 1}\cdot 2^{-j} + 2^j\cdot (1 - 2^{-j}))\Pr\qty[X_n = j]\\ &= \sum_{j = 0}^\infty\qty(2^j + 1)\Pr\qty[X_n = j]\\ &= \sum_{j = 0}^\infty 2^j\Pr\qty[X_n = j] + \sum_{j = 0}^{\infty}\Pr\qty[X_n = j]\\ &= \mathbb E[2^{X_n}] + 1\\ &= n + 2 \\ \end{split} $$ 

$$E[\hat{n}] = E[2^{X_n-1}-1] = n$$

$$Var[n] = E[(\hat{n} - n)^2] = E[(2^{X_n}-1-n)^2] = E[2^{2X_n}] - (n+1)^2 = \frac{n^2}{2} - \frac{n}{2} < \frac{n^2}{2}$$

æ ¹æ®åˆ‡æ¯”é›ªå¤«ä¸ç­‰å¼$Pr[|\hat{n} - n| \geq \epsilon n] \leq \frac{Var[\hat{n}]}{\epsilon^2 n^2} < \frac{1}{2 \epsilon^2}$

å¯ä»¥çœ‹å‡ºæ¥è¿™æ ·æ²¡ä»€ä¹ˆç”¨ï¼Œå½“$\epsilon \geq 1$æ—¶æ¦‚ç‡æ‰å°äº$\frac{1}{2}$ï¼Œä½†è¿™æ—¶è¯¯å·®å¾ˆå¤§äº†



### **Morris+**

- ç‹¬ç«‹è¿è¡Œ$s$æ¬¡Morrisç®—æ³•ï¼Œè®¾è¿™$s$ä¸ªMorrisç®—æ³•çš„è¾“å‡ºåˆ†åˆ«æ˜¯$\hat{n}_1,\hat{n}_2,\cdots,\hat{n}_s$
- è¾“å‡ºè¿™äº›è¾“å‡ºçš„ç®—æœ¯å¹³å‡$\hat{n} = \frac{1}{s} \sum_j^s\hat{n}_j$

é‡æ–°è€ƒè™‘åˆ‡æ¯”é›ªå¤«ä¸ç­‰å¼$Pr[|\hat{n} - n| \geq \epsilon n] \leq \frac{Var[\hat{n}]}{\epsilon^2 n^2} < \frac{1}{2s \epsilon^2}$

å¯¹äºä»»æ„çš„$\delta$ï¼Œåªéœ€è¦å–$s \geq \frac{1}{2\delta\epsilon^2}$ï¼Œå°±èƒ½è®©$Pr[|\hat{n} - n| \geq \epsilon n] \leq \delta$



### **Morris++**

- å¯¹äºæ‰€æœ‰çš„$i \leq t$ï¼Œå¦‚æœç¬¬$i$ä¸ªMorris+ç®—æ³•ç»™å‡ºäº†æ­£ç¡®çš„ç»“æœ($\hat{n} - n| \leq \epsilon n$)ï¼Œä»¤$Y_i = 1$ï¼Œå¦åˆ™è®°ä¸º$0$ã€‚è¦ä½¿å¾—$Pr[Y_i = 1] > \frac{2}{3}$ï¼Œä¹Ÿå°±æ˜¯å–$\delta = \frac{1}{3},s = \frac{3}{2\epsilon^2}$
- è¾“å‡º$\hat{n}_1,\hat{n}_2,\cdots,\hat{n}_s$çš„ä¸­ä½æ•°$\hat{n}$

è®°$Y = \sum_iY_i$ä¸ºMorrisç®—æ³•ä¸­æ­£ç¡®çš„æ•°é‡ï¼Œé‚£ä¹ˆ$E[Y] \geq \frac{2}{3}t$

å› ä¸ºè¾“å‡ºçš„æ˜¯ä¸­ä½æ•°$\hat{n}$ï¼Œåªè¦$Y \geq \frac{1}{2}t$ï¼Œå°±èƒ½ç»™å‡ºç†æƒ³çš„ç»“æœ

$Pr[\hat{n} = bad] \leq Pr[Y \leq \frac{t}{2}] < Pr[Y-E[Y]<-\frac{t}{6}] \leq e^{-2(\frac{1}{6})^2t} \leq \delta$

å½“$t \geq 18ln(\frac{1}{\delta})$æ—¶ï¼Œå°±èƒ½å¾—åˆ°éœ€è¦çš„ç»“æœ

æ‰€éœ€è¦çš„ç©ºé—´

- ç®—æ³•éœ€è¦çš„s,t   ($O(\frac{1}{\epsilon^2}ln(\frac{1}{\delta}))$)

- æˆ‘ä»¬æ¥ä¸‹æ¥è¯æ˜ï¼šå¦‚æœè°ƒç”¨äº† $s^*$ æ¬¡ Morris ç®—æ³•ï¼Œé‚£ä¹ˆä»¥è‡³å°‘ $\delta^*$ çš„æ¦‚ç‡ï¼Œåœ¨è¿™ ğ‘› æ¬¡è®¡æ•°è¿‡ç¨‹ä¸­æ¯ä¸€ä¸ªæ•°éƒ½ä¸è¶…è¿‡ $\log\qty(\frac{s^*n}{\delta^*})$

  å‡è®¾æŸä¸ª Morris ç®—æ³•åœ¨è¿‡ç¨‹ä¸­è¾¾åˆ°äº† $X = \log(\frac{s^*n}{\delta^*})$ï¼Œé‚£ä¹ˆå®ƒå†å¢åŠ ä¸€æ¬¡çš„æ¦‚ç‡æ˜¯ $\frac 1{2^X}\leq\frac{\delta^*}{s^*n}$ã€‚å› ä¸º $X$ æ€»å…±åªæœ‰ $n$ ä¸ªæœºä¼šå¢åŠ ï¼Œæ‰€ä»¥ $X$ åœ¨ç®—æ³•ç»“æŸçš„æ—¶å€™æœ‰è‡³å¤š $\frac n{2^X}\leq\frac{\delta^*}{s^*}$ çš„æ¦‚ç‡å¢åŠ ã€‚æ€»å…±æœ‰ $s^*$ ä¸ª Morris ç®—æ³•ï¼Œè‡³å¤šæœ‰ $s^*$ ä¸ªæ•°è¾¾åˆ°äº† $\log\qty(\frac{s^*n}{\delta^*})$ éšæ—¶å‡†å¤‡çªç ´ã€‚æ‰€ä»¥åœ¨ç®—æ³•ç»“æŸçš„æ—¶å€™æœ‰è‡³å¤š $\delta^*$ çš„æ¦‚ç‡æŸä¸ª Morris ç®—æ³•çš„ $X$ è¶…è¿‡ $\log\qty(\frac{s^*n}{\delta^*})$ äº†ã€‚è¿™å°±è¡¨æ˜æœ‰è‡³å°‘ $1 - \delta^*$ çš„æ¦‚ç‡æ‰€æœ‰åˆ°è¾¾è¿‡ä¸´ç•Œå€¼ $\log\qty(\frac{s^*n}{\delta^*})$ çš„ ğ‘‹ éƒ½ä¸ä¼šå†å¢é•¿äº†ï¼Œä¹Ÿå°±è¡¨æ˜æœ‰è‡³å°‘ 1âˆ’ğ›¿âˆ— çš„æ¦‚ç‡æ‰€æœ‰ Morris ç®—æ³•ä¸­çš„ ğ‘‹ éƒ½ä¸è¶…è¿‡ $\log(\frac{s^*n}{\delta^*})$

  è¿™å°±è¡¨æ˜ Morris++ ç®—æ³•ä»¥è‡³å°‘ $1 - \delta^*$ çš„æ¦‚ç‡ç©ºé—´å¤æ‚åº¦ä¸º $$ \order{st\log\log(\frac{stn}{\delta^*})} = \order{\qty(\frac 1\epsilon)^2\ln\frac 1\delta\log\log\frac {n\log\frac1\delta}{\epsilon^2\delta^*}} $$

## è“„æ°´æ± æŠ½æ ·

æœ‰ä¸€ä¸ªæ•°æ®æµï¼Œæ•°æ®åœ¨ä¸åœåœ°æµè¿‡â€”â€”ä½ åªèƒ½çœ‹åˆ°æ¯ä¸ªæ•°æ®ä¸€æ¬¡å¹¶ä¸”ä¸èƒ½å°†å®ƒä»¬å…¨éƒ¨å­˜å‚¨ä¸‹æ¥ã€‚ä½ åœ¨ä»»æ„æ—¶åˆ»éƒ½å¯èƒ½è¢«è¦æ±‚ï¼šâ€œå°†åˆšåˆšä½ çœ‹åˆ°çš„æ‰€æœ‰æ•°ä¸­å‡åŒ€éšæœºæŠ½å–ä¸€ä¸ªç»™æˆ‘ã€‚â€

å‡è®¾çœ‹åˆ°çš„æ•°ä¾æ¬¡ä¸º $\{a_i\}_{i = 1, 2, \cdots,\infty}$ã€‚çš„æ€æƒ³ï¼Œå¯ä»¥å®ç°å¦‚ä¸‹åœ°ç®—æ³•ï¼š

- ç»´æŠ¤å˜é‡ $s$ï¼Œåˆå§‹æ—¶å€¼æœªå®šä¹‰
- å½“çœ‹åˆ°æ•°æ® $a_m$ çš„æ—¶å€™ï¼Œæ·éª°å­ï¼Œä»¥ $\frac{1}{m}$ çš„æ¦‚ç‡ä»¤ $s \leftarrow a_m$ï¼Œä»¥ $1 - \frac{1}{m}$ çš„æ¦‚ç‡ä¿æŒ $s$ ä¸å˜
- æŸ¥è¯¢æ—¶ï¼Œç›´æ¥è¾“å‡º $s$

è¿™ä¸ªç®—æ³•çš„æ­£ç¡®æ€§æ¯”è¾ƒæ˜¾ç„¶ã€‚

å½“æ•°æ®æµä¸­æµè¿‡ $m$ ä¸ªæ•°çš„æ—¶å€™ï¼Œå¦‚æœ $s = a_i$ï¼Œé‚£ä¹ˆç¬¬ $i$ æ¬¡æ·éª°å­æ·å¾—äº† $\frac{1}{i}$ å°† $a_i$ ä¿ç•™ä¸‹æ¥ï¼Œè€Œåœ¨ç¬¬ $i+1,i+2,\cdots,m$ çš„æ—¶å€™æ·å¾—äº† $1âˆ’\frac{1}{i+1},1-\frac{1}{i+2},â‹¯,1âˆ’\frac{1}{m}$ è€Œæ²¡æœ‰å°† $a_i$ æ‰”æ‰ã€‚

è¿™äº›äº‹ä»¶éƒ½æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥ $$ \Pr\qty[s_m = a_i] = \frac 1i\cdot \frac i{i + 1}\cdot \frac{i + 1}{i + 2}\cdots\frac {m - 1}m = \frac 1m $$ å¯¹äºä»»æ„çš„ $i = 2,3,\cdots,m$ å‡æˆç«‹ï¼Œä¹Ÿå°±æ˜¯è¯´ $a_1,a_2,\cdots,a_m$ èƒ½ç­‰æ¦‚ç‡åœ°åœ¨ç¬¬ $m$ æ¬¡å‡ºç°

åˆ†æä¸€ä¸‹ç©ºé—´å¤æ‚åº¦ã€‚æˆ‘ä»¬éœ€è¦å­˜å‚¨è¢«æŠ½æ ·çš„æ•°ä¸å½“å‰ç»è¿‡äº†å¤šå°‘æ•°ã€‚å‡è®¾æ‰€æœ‰æ•°éƒ½ä¸è¶…è¿‡ ğ‘›ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç©ºé—´å¤æ‚åº¦å°±æ˜¯ $\order{logâ¡n+logâ¡m}$

## ä¼°è®¡ä¸åŒå…ƒç´ ä¸ªæ•°

éœ€è¦åœ¨ä»»æ„æ—¶åˆ»ä¼°è®¡å½“å‰æ•°æ®æµä¸­ä¸åŒå…ƒç´ çš„ä¸ªæ•°ï¼Œå¹¶ä¸”ç”¨å°½å¯èƒ½å°‘çš„äº‹ä»¶ã€‚è®¾æ•°æ®æµæ˜¯ $\{a_i\}_{i = 1,2,\cdots}$ è€Œä¸”æ‰€æœ‰æ•°éƒ½æ˜¯æ•´æ•°ï¼Œä½ éœ€è¦åœ¨é€ä¸€è¯»å–è¿™äº›æ•°æ®çš„æ—¶å€™éšæ—¶å‡†å¤‡å¥½å›ç­” ä¸åŒå…ƒç´ ä¸ªæ•°

è®¾è¿™ä¸ªæ•°æ®æµä¸­æ•°çš„ä¸Šç•Œæ˜¯ ğ‘›ï¼Œåœ¨è¯»å–å®Œå‰ ğ‘š ä¸ªæ•°çš„æ—¶å€™è¢«è¦æ±‚ä½œç­”ã€‚å¦‚æœéœ€è¦æ±‚å‡ºç²¾ç¡®è§£ï¼š

1. ç»´æŠ¤ä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ•°ç»„ ï¼Œå¦‚æœç¬¬$i$ä¸ªæ•°çœ‹è§äº†å°±ç½®ä¸º$1$(space: $n$ bits)

2. å°†å…¨éƒ¨æ•°æ®æµå­˜åœ¨å†…å­˜ä¸­(space: $mlog(n)$ bits)

   éœ€è¦$min\{n,mlog(n)\}$æ¯”ç‰¹å†…å­˜

æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªç©ºé—´å¤æ‚åº¦æ˜¯ $\order {logâ¡(nm)}$ çš„è¿‘ä¼¼ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å¯¹ä»»æ„çš„å‚æ•° $\epsilon,\delta \in (0,1)$ï¼Œæ±‚å‡ºä¸€ä¸ª $\hat{t}$ æ»¡è¶³ $Pr\qty[|\hat{t}-t| > \epsilon t] < \delta$ï¼Œå…¶ä¸­ $t$ æ˜¯æ•°æ®æµä¸­ä¸åŒå…ƒç´ çš„ä¸ªæ•°

### FMç®—æ³•

- é€‰æ‹©ä¸€ä¸ªéšæœºå‡½æ•°$h:[n] \rightarrow [0,1]$

- ä¿ç•™ä¸€ä¸ªè®¡æ•°å™¨$X:min_{i\in stream}h(i)$
- è¾“å‡º$\hat{t} = \frac{1}{x}-1$

æ–­è¨€1ï¼š$E[X] = \frac{1}{t+1}$

è¯æ˜ï¼š

â€‹	$\begin{split} E[X] &= \int_0^{\infty}Pr[X \geq \lambda]d\lambda \\ &= \int_0^{\infty}Pr[i \in stream,h(i)\geq\lambda] \\ &= \int_0^{\infty}\Pi_r^t Pr[h(i_r) \geq \lambda]d\lambda \\ &= \int_0^1(1-\lambda)^td\lambda \\ &= \frac{1}{t+1} \end{split}$

æ–­è¨€2ï¼š$E[X^2] = \frac{2}{(t+1)(t+2)}$

è¯æ˜ï¼š

â€‹	$\begin{split} E[X^2] &=\int_0^{\infty}Pr[X^2\geq\lambda]\lambda \\ &= \int_0^{\infty}Pr[X\geq\sqrt{\lambda}]d\lambda \\ &=\int_0^{\infty}(1-\sqrt{\lambda})^td\lambda \\ &= 2\int_0^1u^t(1-u)du \\ &=\frac{2}{(t+1)(t+2)}   \end{split}$

å› æ­¤$Var[X] = E[X^2] - (E[X])^2 = \frac{t}{(t+1)^2(t+2)} < \frac{1}{(t+1)^2}$



### FM+ç®—æ³•

- ç‹¬ç«‹è¿è¡Œ$s = \frac{25}{\epsilon^2\delta}$æ¬¡FMç®—æ³•ï¼Œå¹¶ä¸”å¾—åˆ°ç»“æœ$X_1,\cdots,X_s$

- ä»¤$Z = \frac{1}{s}\sum_i^sX_i$ï¼Œè¾“å‡º$\hat{t} = \frac{1}{z}-1$

æ–­è¨€3ï¼š$Pr[|Z - \frac{1}{t+1}| > \frac{\delta}{5(t+1)}] < \delta$

è¯æ˜ï¼š

â€‹	$\begin{split} E[Z] &= \frac{1}{t+1} \\ \end{split}$ 

â€‹	$Var[Z] < \frac{1}{s(t+1)^2}$

â€‹	ç”±äºåˆ‡æ¯”é›ªå¤«ä¸ç­‰å¼

â€‹	$Pr[|Z-\frac{1}{t+1}| > \frac{\epsilon}{5(t+1)}] < \frac{25(t+1)^2}{\epsilon^2}\frac{1}{s(t+1)^2} < \delta$

æ–­è¨€4ï¼š$Pr[|(\frac{1}{z}-t| > \epsilon t] < \delta$ï¼Œif $\epsilon < \frac{1}{2}$

è¯æ˜ï¼š

â€‹	å¦‚æœ$t = 0$ï¼Œç»“æœæ˜¯æ˜¾ç„¶çš„

â€‹	å¦‚æœ$t \geq 1$ï¼Œæ ¹æ®æ–­è¨€3ï¼Œæœ‰å¤§äº$1-\delta$çš„æ¦‚ç‡æ»¡è¶³

â€‹	$\frac{1-\frac{\epsilon}{5}}{t+1} < Z < \frac{1+\frac{\epsilon}5{}}{t+1}$

â€‹	$\rightarrow \frac{t+1}{1+\frac{\epsilon}{5}} < \frac{1}{Z} < \frac{t+1}{1-\frac{\epsilon}{5}}$

â€‹	$\rightarrow \frac{t-\frac{\epsilon}{5}}{1+\frac{\epsilon}{5}} < \frac{1}{Z} - 1 < \frac{t+\frac{\epsilon}{5}}{1-\frac{\epsilon}{5}}$

â€‹	$\rightarrow \frac{1}{Z} - 1 > \frac{t-\frac{\epsilon}{5}}{1+\frac{\epsilon}{5}} = t -\frac{2\epsilon t}{5} + \frac{\epsilon^2}{25} > t - \epsilon t$

â€‹	åŒç†$\frac{1}{Z} < t + \epsilon t$ (éœ€è¦åˆ©ç”¨$\epsilon \leq \frac{1}{2}$)

â€‹	æ‰€ä»¥æœ‰$|\frac{1}{Z} - 1 - t| < \epsilon t$



### FM++ç®—æ³•

- ç‹¬ç«‹è¿è¡Œ$q = 18ln(\frac{1}{\delta})$æ¬¡FM+ç®—æ³•ï¼Œå…¶ä¸­$\delta_{FM+} = \frac{1}{3}$ã€‚å¾—åˆ°ç»“æœ$\hat{t}_1,\cdots,\hat{t}_q$
- è¾“å‡ºå¾—åˆ°$\hat{t}_1,\cdots,\hat{t}_q$çš„ä¸­ä½æ•°$\hat{t}$

æ–­è¨€5ï¼š$Pr[|\hat{t}-t| > \epsilon t] \leq \delta$

â€‹	è¯æ˜å’ŒMorris++æ—¶ä¸€æ ·